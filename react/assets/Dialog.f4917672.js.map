{"version":3,"file":"Dialog.f4917672.js","sources":["../../../../packages/core/src/styles/system/feedback/dialog/helpers.ts","../../../../node_modules/usehooks-ts/dist/esm/useIsomorphicLayoutEffect/useIsomorphicLayoutEffect.js","../../../../node_modules/usehooks-ts/dist/esm/useEventListener/useEventListener.js","../../../../node_modules/usehooks-ts/dist/esm/useOnClickOutside/useOnClickOutside.js","../../../../packages/react/src/lib/internal/hooks/useToggle.ts","../../../../packages/react/src/lib/Feedback/Dialog/Dialog.tsx"],"sourcesContent":["import { vars } from '../../../variables/index.css';\nimport { dialogInAnimation, dialogOutAnimation } from './dialog.css';\nimport { DialogPositions } from './types';\n\nconst makeAnimation = (keyframes: string) =>\n  `${keyframes} 0.5s ${vars.transition.easing}`;\n\nexport const getDialogAnimation = (isMounting: boolean) => {\n  return makeAnimation(isMounting ? dialogInAnimation : dialogOutAnimation);\n};\n\nconst isOutOfBounds = (\n  position: DialogPositions,\n  element: { left: number; top: number }\n) => {\n  const { left, top } = element;\n  console.log(`isOutOfBoundsInner: ${position}`, { left, top });\n\n  if (typeof window === 'undefined') return false;\n  // const { innerWidth, innerHeight } = window;\n  if (top < 0) return true;\n  if (left < 0) return true;\n  return false;\n};\n\nconst getOtherPosition = (position: DialogPositions) => {\n  switch (position) {\n    case 'left':\n      return 'right';\n    case 'right':\n      return 'left';\n    case 'top':\n      return 'bottom';\n    case 'bottom':\n      return 'top';\n    default:\n      return 'left';\n  }\n};\n\ntype Position = {\n  left: number;\n  top: number;\n  position?: DialogPositions;\n};\n\nconst addGutter = (\n  positionType: DialogPositions,\n  position: Position,\n  gutter: string\n) => {\n  switch (positionType) {\n    case 'left':\n      return {\n        top: `${position.top}px`,\n        left: `calc(${position.left}px - ${gutter})`,\n      };\n    case 'right':\n      return {\n        top: `${position.top}px`,\n        left: `calc(${position.left}px + ${gutter})`,\n      };\n    case 'top':\n      return {\n        left: `${position.left}px`,\n        top: `calc(${position.top}px - ${gutter})`,\n      };\n    case 'bottom':\n      return {\n        left: `${position.left}px`,\n        top: `calc(${position.top}px + ${gutter})`,\n      };\n    default:\n      return position;\n  }\n};\n\nexport const getDialogPositionPrecursor = (\n  position: DialogPositions,\n  dialogRef: HTMLDivElement | null,\n  elementRef: HTMLElement | null\n) => {\n  let finalPosition: Position = {\n    top: 0,\n    left: 0,\n  };\n  if (!dialogRef || !elementRef) return finalPosition;\n  const dialogRect = dialogRef.getBoundingClientRect();\n  const elementRect = elementRef.getBoundingClientRect();\n  if (position === 'left') {\n    finalPosition = {\n      left: elementRect.left - dialogRect.width,\n      top: elementRect.top + elementRect.height / 2 - dialogRect.height / 2,\n    };\n  }\n  if (position === 'right') {\n    finalPosition = {\n      left: elementRect.left + elementRect.width,\n      top: elementRect.top + elementRect.height / 2 - dialogRect.height / 2,\n    };\n  }\n  if (position === 'top') {\n    finalPosition = {\n      left: elementRect.left + elementRect.width / 2 - dialogRect.width / 2,\n      top: elementRect.top - dialogRect.height,\n    };\n  }\n  if (position === 'bottom') {\n    finalPosition = {\n      left: elementRect.left + elementRect.width / 2 - dialogRect.width / 2,\n      top: elementRect.top + elementRect.height,\n    };\n  }\n\n  if (isOutOfBounds(position, finalPosition)) {\n    finalPosition = getDialogPositionPrecursor(\n      getOtherPosition(position),\n      dialogRef,\n      elementRef\n    );\n    finalPosition = {\n      ...finalPosition,\n      position: getOtherPosition(position),\n    };\n  }\n  return finalPosition;\n};\n\nexport const getDialogPosition = (\n  position: DialogPositions,\n  dialogRef: HTMLDivElement | null,\n  elementRef: HTMLElement | null\n): {\n  top: string;\n  left: string;\n} => {\n  const gutter = vars.spacing.md;\n  const positionPrecursor = getDialogPositionPrecursor(\n    position,\n    dialogRef,\n    elementRef\n  );\n  const calculatedPosition = addGutter(\n    positionPrecursor.position || position,\n    positionPrecursor,\n    gutter\n  );\n  const finalPosition = {\n    top:\n      typeof calculatedPosition.top !== 'string'\n        ? `${calculatedPosition.top}`\n        : calculatedPosition.top,\n    left:\n      typeof calculatedPosition.left !== 'string'\n        ? `${calculatedPosition.left}`\n        : calculatedPosition.left,\n  };\n  console.log({ calculatedPosition, finalPosition });\n  return finalPosition;\n};\n\nexport const isClickOutside = <T extends HTMLElement>(\n  event: MouseEvent,\n  dialogRef: T | null,\n  callback: () => void\n) => {\n  if (!dialogRef) return;\n\n  // Do nothing if clicking ref's element or descendent elements\n  if (!dialogRef || dialogRef.contains(event.target as Node)) {\n    return;\n  }\n  callback();\n};\n","import { useEffect, useLayoutEffect } from 'react';\nconst useIsomorphicLayoutEffect = typeof window !== 'undefined' ? useLayoutEffect : useEffect;\nexport default useIsomorphicLayoutEffect;\n//# sourceMappingURL=useIsomorphicLayoutEffect.js.map","import { useEffect, useRef } from 'react';\nimport { useIsomorphicLayoutEffect } from '../useIsomorphicLayoutEffect';\nfunction useEventListener(eventName, handler, element, options) {\n    const savedHandler = useRef(handler);\n    useIsomorphicLayoutEffect(() => {\n        savedHandler.current = handler;\n    }, [handler]);\n    useEffect(() => {\n        const targetElement = element?.current || window;\n        if (!(targetElement && targetElement.addEventListener)) {\n            return;\n        }\n        const eventListener = event => savedHandler.current(event);\n        targetElement.addEventListener(eventName, eventListener, options);\n        return () => {\n            targetElement.removeEventListener(eventName, eventListener);\n        };\n    }, [eventName, element, options]);\n}\nexport default useEventListener;\n//# sourceMappingURL=useEventListener.js.map","import { useEventListener } from '../useEventListener';\nfunction useOnClickOutside(ref, handler, mouseEvent = 'mousedown') {\n    useEventListener(mouseEvent, event => {\n        const el = ref?.current;\n        if (!el || el.contains(event.target)) {\n            return;\n        }\n        handler(event);\n    });\n}\nexport default useOnClickOutside;\n//# sourceMappingURL=useOnClickOutside.js.map","import { useCallback, useState } from 'react';\n\nconst opposite = (e: boolean) => !e;\n\nexport const useToggle = (initalValue = false) => {\n  const [value, setValue] = useState(initalValue);\n  const toggle = useCallback(() => setValue(opposite), [setValue]);\n  const setTrue = useCallback(() => setValue(true), [setValue]);\n  const setFalse = useCallback(() => setValue(false), [setValue]);\n  return {\n    value,\n    toggle,\n    setTrue,\n    setFalse,\n    setValue,\n  };\n};\n","import {\n  clsx,\n  dialog,\n  DialogPositions,\n  getDialogAnimation,\n  getDialogPosition,\n} from '@icarus/core';\nimport {\n  Children,\n  cloneElement,\n  PropsWithChildren,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\nimport { useDelayedUnmount } from '../../internal/hooks/useDelayedUnmount';\nimport { useEventListener, useOnClickOutside } from 'usehooks-ts';\nimport { useToggle } from '../../internal/hooks/useToggle';\nimport { Portal } from '../../internal/Portal';\ntype P2 = {\n  content?: JSX.Element;\n  visible?: boolean;\n  position?: DialogPositions;\n  parentElement: HTMLElement | null;\n  className?: string;\n  toggle: (event: MouseEvent) => void;\n};\ntype P = Omit<P2, 'parentElement' | 'toggle'> & {\n  triggerable?: boolean;\n};\n\nconst DialogBase = ({\n  children,\n  visible = false,\n  position: positionProp = 'top',\n  parentElement,\n  className,\n  toggle,\n}: PropsWithChildren<P2>) => {\n  console.log('content', children);\n  const ref = useRef<HTMLDivElement>(null);\n  const [position, setPosition] = useState({ left: '0px', top: '0px' });\n  useEffect(() => {\n    const finalPosition = getDialogPosition(\n      positionProp,\n      ref.current,\n      parentElement\n    );\n    console.log({\n      finalPosition,\n      positionProp,\n      ref: ref.current,\n      parentElement,\n    });\n    setPosition(finalPosition);\n  }, [parentElement, positionProp]);\n  useOnClickOutside(ref, toggle, 'mousedown');\n  return (\n    <Portal>\n      <div\n        ref={ref}\n        className={clsx(dialog, className)}\n        style={{\n          animation: getDialogAnimation(visible),\n          ...position,\n        }}\n      >\n        {children}\n      </div>\n    </Portal>\n  );\n};\n\nexport const Dialog = ({\n  children,\n  triggerable = true,\n  content,\n  visible: visibleProp = false,\n  className,\n}: PropsWithChildren<P>) => {\n  console.log({ content });\n  if (Children.count(children) > 1)\n    throw Error(\"Popover can't have more than one child\");\n\n  const {\n    value: innerVisible,\n    toggle: toggleInnerVisible,\n    setValue: setInnerVisible,\n  } = useToggle(visibleProp);\n  const visibleFiltered = triggerable && innerVisible;\n  const visible = useDelayedUnmount(visibleFiltered, 500);\n  const popRef = useRef<HTMLButtonElement>(null);\n  useEffect(() => {\n    setInnerVisible(visibleProp);\n  }, [setInnerVisible, visibleProp]);\n\n  const listener = useCallback(\n    (event: MouseEvent) => {\n      event.preventDefault();\n      event.stopPropagation();\n      toggleInnerVisible();\n    },\n    [toggleInnerVisible]\n  );\n\n  useEventListener('mousedown', listener, popRef);\n  // eslint-disable-next-line react/jsx-no-useless-fragment\n  if (!triggerable || !content) return <>{children}</>;\n\n  return (\n    <>\n      {visible && (\n        <DialogBase\n          {...{\n            visible: visibleFiltered,\n            parentElement: popRef.current,\n            className,\n            toggle: listener,\n          }}\n        >\n          {content}\n        </DialogBase>\n      )}\n      {cloneElement(children as JSX.Element, {\n        ref: popRef,\n      })}\n    </>\n  );\n};\n"],"names":["useLayoutEffect","useEffect","useRef","useState","useCallback","children","parentElement","className","toggle","console","finalPosition","positionProp","current","setPosition","useOnClickOutside","_jsx","position","content","Children","innerVisible","toggleInnerVisible","setInnerVisible","event","useEventListener","_Fragment","_jsxs","visibleFiltered","listener","popRef"],"mappings":"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"}