{"version":3,"file":"Dialog.5391a0cc.js","sources":["../../../../packages/core/src/styles/system/feedback/dialog/helpers.ts","../../../../node_modules/usehooks-ts/dist/esm/useIsomorphicLayoutEffect/useIsomorphicLayoutEffect.js","../../../../node_modules/usehooks-ts/dist/esm/useEventListener/useEventListener.js","../../../../node_modules/usehooks-ts/dist/esm/useOnClickOutside/useOnClickOutside.js","../../../../packages/react/src/lib/internal/hooks/useToggle.ts","../../../../packages/react/src/lib/Feedback/Dialog/Dialog.tsx"],"sourcesContent":["import { vars } from '../../../variables/index.css';\nimport { dialogInAnimation, dialogOutAnimation } from './dialog.css';\nimport { DialogPositions } from './types';\n\ntype Position = {\n  top: string;\n  left: string;\n};\n\nexport const DIALOG_ANIMATION_LENGTH = 0.26;\n\nconst makeAnimation = (keyframes: string) =>\n  `${keyframes} ${DIALOG_ANIMATION_LENGTH}s ${vars.transition.easing}`;\n\nexport const getDialogAnimation = (isMounting: boolean) => {\n  return makeAnimation(isMounting ? dialogInAnimation : dialogOutAnimation);\n};\n\n// const oposites = {\n//   left: 'right',\n//   right: 'left',\n//   top: 'bottom',\n//   bottom: 'top',\n// } as const;\n\nconst getPositionForSide = (\n  position: DialogPositions,\n  dialog: DOMRect,\n  element: DOMRect\n): {\n  left: number;\n  top: number;\n} => {\n  const xCenter = element.left + (element.width / 2 - dialog.width / 2);\n  console.log(dialog.width);\n  const yCenter = element.top + (element.height / 2 - dialog.height / 2);\n  let positionReturn = {\n    left: 0,\n    top: 0,\n  };\n  if (position === 'left') {\n    const left = element.left - dialog.width;\n    const top = yCenter;\n    positionReturn = { left, top };\n  }\n  if (position === 'right') {\n    const left = element.left + element.width;\n    const top = yCenter;\n    positionReturn = { left, top };\n  }\n  if (position === 'top') {\n    const left = xCenter;\n    const top = element.top - dialog.height;\n    positionReturn = { left, top };\n  }\n  if (position === 'bottom') {\n    const left = xCenter;\n    const top = element.top + element.height;\n    positionReturn = { left, top };\n  }\n  if (positionReturn.left <= 0) {\n    positionReturn.left = element.left;\n  }\n  if (positionReturn.top <= 0) {\n    positionReturn.top = element.top;\n  }\n  return positionReturn;\n};\n\nexport const getDialogPosition = (\n  position: DialogPositions,\n  dialogRef: HTMLDivElement | null,\n  elementRef: HTMLElement | null\n): Position => {\n  if (typeof window === 'undefined' || !dialogRef || !elementRef)\n    return { top: '0px', left: '0px' };\n  const defaultGutter = vars.spacing.md;\n  const dialogRect = dialogRef.getBoundingClientRect();\n  const { height: dialogHeight, width: dialogWidth } = dialogRect;\n  const elementRect = elementRef.getBoundingClientRect();\n  const {\n    height: triggerHeight,\n    width: triggerWidth,\n    left: triggerOffsetX,\n    top: triggeroffsetY,\n  } = elementRect;\n  if (position === 'left') {\n    if (triggerOffsetX <= dialogWidth) {\n      position = 'right';\n    }\n  }\n  if (position === 'right') {\n    if (triggerOffsetX + triggerWidth >= window.innerWidth - dialogWidth) {\n      position = 'left';\n    }\n  }\n  if (position === 'top') {\n    if (triggeroffsetY <= dialogHeight) {\n      position = 'bottom';\n    }\n  }\n  if (position === 'bottom') {\n    if (triggeroffsetY + triggerHeight >= window.innerHeight - dialogHeight) {\n      position = 'top';\n    }\n  }\n\n  const finalPosition = getPositionForSide(position, dialogRect, elementRect);\n  const newPositions: Partial<Position> = {};\n  if (position === 'left') {\n    newPositions.left = `calc(${finalPosition.left}px - ${defaultGutter})`;\n  }\n  if (position === 'right') {\n    newPositions.left = `calc(${finalPosition.left}px + ${defaultGutter})`;\n  }\n  if (position === 'top') {\n    newPositions.top = `calc(${finalPosition.top}px - ${defaultGutter})`;\n  }\n  if (position === 'bottom') {\n    newPositions.top = `calc(${finalPosition.top}px + ${defaultGutter})`;\n  }\n  return {\n    top: `${finalPosition.top}px`,\n    left: `${finalPosition.left}px`,\n    ...newPositions,\n  };\n};\n\nexport const isClickOutside = <T extends HTMLElement>(\n  event: MouseEvent,\n  dialogRef: T | null,\n  callback: () => void\n) => {\n  if (!dialogRef) return;\n\n  // Do nothing if clicking ref's element or descendent elements\n  if (!dialogRef || dialogRef.contains(event.target as Node)) {\n    return;\n  }\n  callback();\n};\n","import { useEffect, useLayoutEffect } from 'react';\nconst useIsomorphicLayoutEffect = typeof window !== 'undefined' ? useLayoutEffect : useEffect;\nexport default useIsomorphicLayoutEffect;\n//# sourceMappingURL=useIsomorphicLayoutEffect.js.map","import { useEffect, useRef } from 'react';\nimport { useIsomorphicLayoutEffect } from '../useIsomorphicLayoutEffect';\nfunction useEventListener(eventName, handler, element, options) {\n    const savedHandler = useRef(handler);\n    useIsomorphicLayoutEffect(() => {\n        savedHandler.current = handler;\n    }, [handler]);\n    useEffect(() => {\n        const targetElement = element?.current || window;\n        if (!(targetElement && targetElement.addEventListener)) {\n            return;\n        }\n        const eventListener = event => savedHandler.current(event);\n        targetElement.addEventListener(eventName, eventListener, options);\n        return () => {\n            targetElement.removeEventListener(eventName, eventListener);\n        };\n    }, [eventName, element, options]);\n}\nexport default useEventListener;\n//# sourceMappingURL=useEventListener.js.map","import { useEventListener } from '../useEventListener';\nfunction useOnClickOutside(ref, handler, mouseEvent = 'mousedown') {\n    useEventListener(mouseEvent, event => {\n        const el = ref?.current;\n        if (!el || el.contains(event.target)) {\n            return;\n        }\n        handler(event);\n    });\n}\nexport default useOnClickOutside;\n//# sourceMappingURL=useOnClickOutside.js.map","import { useCallback, useState } from 'react';\n\nconst opposite = (e: boolean) => !e;\n\nexport const useToggle = (initalValue = false) => {\n  const [value, setValue] = useState(initalValue);\n  const toggle = useCallback(() => setValue(opposite), [setValue]);\n  const setTrue = useCallback(() => setValue(true), [setValue]);\n  const setFalse = useCallback(() => setValue(false), [setValue]);\n  return {\n    value,\n    toggle,\n    setTrue,\n    setFalse,\n    setValue,\n  };\n};\n","import {\n  clsx,\n  dialog,\n  DialogPositions,\n  DIALOG_ANIMATION_LENGTH,\n  getDialogAnimation,\n  getDialogPosition,\n} from '@icarus/core';\nimport {\n  Children,\n  cloneElement,\n  PropsWithChildren,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\nimport { useDelayedUnmount } from '../../internal/hooks/useDelayedUnmount';\nimport { useEventListener, useOnClickOutside } from 'usehooks-ts';\nimport { useToggle } from '../../internal/hooks/useToggle';\nimport { Portal } from '../../internal/Portal';\ntype P2 = {\n  content?: JSX.Element;\n  visible?: boolean;\n  position?: DialogPositions;\n  parentElement: HTMLElement | null;\n  className?: string;\n  toggle: (event: MouseEvent) => void;\n};\ntype P = Omit<P2, 'parentElement' | 'toggle'> & {\n  triggerable?: boolean;\n};\n\nconst DialogBase = ({\n  children,\n  visible = false,\n  position: positionProp = 'top',\n  parentElement,\n  className,\n  toggle,\n}: PropsWithChildren<P2>) => {\n  const ref = useRef<HTMLDivElement>(null);\n  const [position, setPosition] = useState({ left: '0px', top: '0px' });\n  useEffect(() => {\n    const finalPosition = getDialogPosition(\n      positionProp,\n      ref.current,\n      parentElement\n    );\n\n    setPosition(finalPosition);\n  }, [parentElement, positionProp]);\n  useOnClickOutside(ref, toggle, 'mousedown');\n  return (\n    <Portal>\n      <div\n        ref={ref}\n        className={clsx(dialog, className)}\n        style={{\n          animation: getDialogAnimation(visible),\n          ...position,\n        }}\n      >\n        {children}\n      </div>\n    </Portal>\n  );\n};\n\nexport const Dialog = ({\n  children,\n  triggerable = true,\n  content,\n  visible: visibleProp = false,\n  className,\n  position,\n}: PropsWithChildren<P>) => {\n  if (Children.count(children) > 1)\n    throw Error(\"Popover can't have more than one child\");\n\n  const {\n    value: innerVisible,\n    toggle: toggleInnerVisible,\n    setValue: setInnerVisible,\n  } = useToggle(visibleProp);\n  const visibleFiltered = triggerable && innerVisible;\n  const visible = useDelayedUnmount(\n    visibleFiltered,\n    DIALOG_ANIMATION_LENGTH * 1000\n  );\n  const popRef = useRef<HTMLButtonElement>(null);\n  useEffect(() => {\n    setInnerVisible(visibleProp);\n  }, [setInnerVisible, visibleProp]);\n\n  const listener = useCallback(\n    (event: MouseEvent) => {\n      event.preventDefault();\n      event.stopPropagation();\n      toggleInnerVisible();\n    },\n    [toggleInnerVisible]\n  );\n\n  useEventListener('mousedown', listener, popRef);\n  // eslint-disable-next-line react/jsx-no-useless-fragment\n  if (!triggerable || !content) return <>{children}</>;\n\n  return (\n    <>\n      {visible && (\n        <DialogBase\n          {...{\n            visible: visibleFiltered,\n            parentElement: popRef.current,\n            className,\n            toggle: listener,\n            position,\n          }}\n        >\n          {content}\n        </DialogBase>\n      )}\n      {cloneElement(children as JSX.Element, {\n        ref: popRef,\n      })}\n    </>\n  );\n};\n"],"names":["useLayoutEffect","useEffect","useRef","useState","useCallback","children","parentElement","className","toggle","setPosition","useOnClickOutside","_jsx","position","content","Children","innerVisible","toggleInnerVisible","setInnerVisible","event","useEventListener","_Fragment","_jsxs","visibleFiltered","current","listener","popRef"],"mappings":"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"}